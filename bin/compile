#!/bin/sh

indent() {
  sed -u 's/^/       /'
}

path=geolite
echo "-----> Creating geolite folder in ${path}"
mkdir -p $path

echo "-----> Downloading databases..."
wget -O "$path/city.mmdb.gz" http://geolite.maxmind.com/download/geoip/database/GeoLite2-City.mmdb.gz
wget -O "$path/country.mmdb.gz" http://geolite.maxmind.com/download/geoip/database/GeoLite2-Country.mmdb.gz

city_checksum=$(curl http://geolite.maxmind.com/download/geoip/database/GeoLite2-City.md5)
country_checksum=$(curl http://geolite.maxmind.com/download/geoip/database/GeoLite2-Country.md5)
echo "-----> Download complete. Verifying checksum..."

city=$(cat "$path/city.mmdb.gz" | md5)
country=$(cat "$path/country.mmdb.gz" | md5)
echo $city_checksum
echo $city
echo $country_checksum
echo $country


if ! [ $city == $city_checksum ]; then
  echo "-----> ERROR: city db checksums does not match"
fi